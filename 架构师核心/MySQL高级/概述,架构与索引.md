## MySQL
### 下载
下载安装[[docker]]在虚拟机中
docker内拉取镜像--> docker pull mysql
使用镜像启动容器->一个镜像可以有多个容器
![[Pasted image 20240126091734.png|300]]
-d: 后台启动
-p: 端口映射
-v: [[数据卷]]/目录映射  本地数据卷管理docker容器内部目录[[docker#数据卷操作|数据卷操作]] 
### 连接
#### 使用客户端工具连接
由于版本的加密规则差异,出现报错
解决方式: 修改加密规则为旧版本
#### 使用docker进入容器
![[Pasted image 20240126093809.png|400]]
## MySQL细节
### 字符集
MySQL8之前默认字符集Latin1^[不支持中文]
自8开始,使用字符集utf8^[支持中文]
utf8分为utf8mb3^[不支持存储表情]和utf8mb4^[可以存储表情😄]
### sql_mode规范
#查看sql_model: 
```
SHOW VARIABLES LIKE 'sql_mode';
```
#### ONLY_FULL_GROUP_BY:
要求groupBy子句中的列必须出现在select表中,或者是聚合函数的参数,否则会抛出错误
编写*分组sql*时,select后可以出现什么内容
	聚合函数^[count,sum,max,min,avg]和分组字段
	单个语句无法实现,使用关联语句来进行实现
![[Pasted image 20240126102641.png|470]]
## MySQL逻辑架构
[[逻辑架构]]即MySQL如何运行
MySQL本质就是文件^[文件系统,ibd后缀]
具体执行流程为:
1. 使用客户端和MySQL服务器进行连接,连接过程中使用连接池
2. 操作之前进行系统管理^[检验用户是否有操作表和数据库的权限]
3. 通过权限校验之后,MySQL服务器根据sql语句匹配对应sql接口
4. 如果是查询语句,把查询语句解析,解析树形结构
5. 解析器解析之后,根据语句进行优化
6. 优化完成之后,执行sql语句,通过存储引擎发起执行
7. 通过存储引擎发送执行,查询文件系统,得到对应的数据,最终返回
# 索引
预: 树,二叉树
## 概述
索引是帮助MySQL高效获取数据的**数据结构**
目录就是典型的索引
使用二叉搜索树建立索引->减少检索次数,快速定位到查找位置,提高效率
![[Pasted image 20240126141529.png|470]]
### 优点
提高数据检索效率,降低IO成本
降低数据排序成本,降低CPU消耗
### **缺点**
创建的索引也需要占用空间^[硬盘空间],维护索引^[空间成本,但是一般允许空间换时间]
索引的目的是提高查询效率,如果表需要频繁的增删改操作,索引反而会导致效率降低^[适用于查操作较多的表,类似于redis]
## 索引结构
### InnoDB
MySQL的InnoDB存储引擎中索引的结构为[[索引树#B+树]]
由于[[索引树#二叉搜索树(BST)|二叉搜索树]]和[[索引树#二叉平衡树(AVL)|二叉平衡树]]存在的缺点,决定采用B树也就是多路平衡搜索树来作为MySQL的索引的结构
尽管B树已经能够存储更多的数据,但是为了更方便的查找数据,在B树的基础上进行改进,引入[[索引树#B+树|B+树]].
使用B+树的优点,B+树使查找数据更方便,把数据的存储做了优化^[叶子结点中根据主键进行的顺序存储],最终目的是降低树的高度,减少io次数^[MySQL本质是文件],提高效率
### MyISAM
MyISAM使用的索引结构为[[索引树#B+树]]
与InnoDB不同的是,InnoDB的B+树其中的叶子节点中的data域中存储的是数据^[是聚簇索引],而MyISAM的叶子节点的data域中存储的是地址值,使用地址值定位到数据的位置来找到数据^[是非聚簇索引]
![[Pasted image 20240127091457.png|400]]
区别及介绍详见 [[存储引擎]]
## MySQL索引类型
第一维度: 主键索引 唯一索引 普通索引 复合索引
第二维度: 聚簇 非聚簇
### 聚簇索引
就是主键索引,根据主键创建索引进行查找,与主键关联,会根据主键值进行排序
创建表时会将主键自动创建索引^[显式]
如果创建表时没有指定主键,也会创建主键索引^[隐式]
### 非聚簇索引
对不是主键的字段创建索引,进行查找的过程^[最终数据都需要通过主键索引找到]
常常也成为: 二级索引,辅助索引
![[Pasted image 20240126193007.png|550]]
步骤: 
总结就是: 拿着非主键索引找到对应的主键,然后通过主键找到数据
1. 对age创建索引,根据age=25找到数据页
2. 找到25数据位置和对应的主键值
3. 拿着第二步找到主键值,使用聚簇索引查找数据^[这步操作就叫回表]
### 其他维度索引
#### 主键索引
表里面主键字段自动创建索引
#### 唯一索引
对(唯一性约束)字段创建索引,username varchar(100)
#### 普通索引
普通字段创建索引
#### 联合索引
为多个字段同时创建索引
可以同时以多个列的大小为排序规则,也就是同时为多个列建立索引
例如 按照c2,c3两个列进行排序/索引
就会先将各个记录和页按照c2列进行排序
在记录的c2列相同的情况下,采用c3列进行排序
#### 覆盖索引
一个索引包含了满足查询结果的所有数据就叫覆盖索引^[select后的字段如果就是索引那么就叫它覆盖索引]
覆盖索引一般针对的是辅助索引，整个査询结果只通过辅助索引就能拿到结果，不需要通过辅助索引树找到主键，再通过主键去主键索引树里获取其它字段值。

我们需要针对的是想要查询的结果->索引的字段就是想要的数据
![[Pasted image 20240126200002.png|500]]
### 索引的使用场景
#### 适合创建索引
1. 频繁作为WHERE查询条件的字段
2. 经常GROUP BY和ORDER BY 的列^[排序,分组]
3. 字段的值有唯一性的限制^[unique]
4. DISTINCT字段需要创建索引^[去重]
5. 多表JOIN时,对连接字段创建索引
6. 使用频繁的列,放到联合索引的左侧^[提高性能]
#### 不要创建索引
- WHERE,GROUP,ORDER BY 里用不到的字段不创建索引
- 表的数据记录太少
- 避免为经常增删改的表创建索引
